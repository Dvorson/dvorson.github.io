<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Anton Dvorson - Solution and software architect with 10+ years experience designing high-traffic e-commerce, media, and digital manufacturing platforms."><title>AWS and Azure Cloud Infrastructure: Enterprise Migration and Optimization Strategies</title><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet"><!-- Icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"><!-- KaTeX for math formatting if needed --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous"><!-- Favicon --><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/_astro/_slug_.7E-Jgt6r.css"></head> <body class="min-h-screen flex flex-col bg-gray-50"> <!-- Navigation --> <nav class="bg-white py-4 border-b border-gray-100 sticky top-0 z-10 shadow-sm"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="text-xl font-bold text-gradient">Anton Dvorson</a> <div class="flex items-center space-x-6"> <a href="/" class="text-gray-600 hover:text-indigo-600 transition-colors font-medium">Home</a> <a href="/categories" class="text-gray-600 hover:text-indigo-600 transition-colors font-medium">Categories</a> <a href="/tags" class="text-gray-600 hover:text-indigo-600 transition-colors font-medium">Tags</a> <a href="https://github.com/dvorson" class="text-gray-600 hover:text-indigo-600 transition-colors" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github text-lg"></i> </a> </div> </div> </nav> <!-- Main Content --> <main class="flex-grow container py-8">  <article class="max-w-4xl mx-auto my-12"> <!-- Article Header --> <header class="mb-12 bg-white rounded-2xl p-8 shadow-sm border border-gray-100"> <div class="max-w-3xl"> <h1 class="text-4xl sm:text-5xl font-bold mb-6 text-gray-900 leading-tight">AWS and Azure Cloud Infrastructure: Enterprise Migration and Optimization Strategies</h1> <div class="flex flex-wrap items-center gap-4 text-gray-600 mb-6"> <time class="flex items-center text-sm font-medium"> <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path> </svg> January 5, 2025 </time>  </div> <p class="text-lg text-gray-700 leading-relaxed mb-6 font-medium">Comprehensive guide to AWS and Azure cloud infrastructure design, migration strategies, and cost optimization. Learn enterprise-grade patterns for building scalable, secure cloud applications.</p> <div class="flex flex-wrap gap-2"> <a href="/tags/AWS/" class="inline-flex items-center px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-100 transition-all duration-200 border border-blue-200 hover:border-blue-300"> <span class="text-xs mr-1">#</span> AWS </a><a href="/tags/Azure/" class="inline-flex items-center px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-100 transition-all duration-200 border border-blue-200 hover:border-blue-300"> <span class="text-xs mr-1">#</span> Azure </a><a href="/tags/Cloud%20Infrastructure/" class="inline-flex items-center px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-100 transition-all duration-200 border border-blue-200 hover:border-blue-300"> <span class="text-xs mr-1">#</span> Cloud Infrastructure </a><a href="/tags/DevOps/" class="inline-flex items-center px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-100 transition-all duration-200 border border-blue-200 hover:border-blue-300"> <span class="text-xs mr-1">#</span> DevOps </a><a href="/tags/Cloud%20Migration/" class="inline-flex items-center px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-100 transition-all duration-200 border border-blue-200 hover:border-blue-300"> <span class="text-xs mr-1">#</span> Cloud Migration </a><a href="/tags/Kubernetes/" class="inline-flex items-center px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-100 transition-all duration-200 border border-blue-200 hover:border-blue-300"> <span class="text-xs mr-1">#</span> Kubernetes </a><a href="/tags/Docker/" class="inline-flex items-center px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-100 transition-all duration-200 border border-blue-200 hover:border-blue-300"> <span class="text-xs mr-1">#</span> Docker </a><a href="/tags/Enterprise%20Architecture/" class="inline-flex items-center px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-100 transition-all duration-200 border border-blue-200 hover:border-blue-300"> <span class="text-xs mr-1">#</span> Enterprise Architecture </a> </div> </div> </header> <!-- Article Content --> <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"> <div class="p-8 sm:p-12"> <div class="prose prose-lg prose-gray max-w-none prose-headings:text-gray-900 prose-headings:font-bold prose-h1:text-3xl prose-h1:mb-8 prose-h1:pb-4 prose-h1:border-b prose-h1:border-gray-200 prose-h2:text-2xl prose-h2:mt-12 prose-h2:mb-6 prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-4 prose-p:text-gray-700 prose-p:leading-relaxed prose-p:mb-6 prose-a:text-blue-600 prose-a:no-underline hover:prose-a:text-blue-700 hover:prose-a:underline prose-strong:text-gray-900 prose-strong:font-semibold prose-code:text-pink-600 prose-code:bg-gray-100 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:font-medium prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:rounded-xl prose-pre:p-6 prose-pre:overflow-x-auto prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:bg-blue-50 prose-blockquote:p-6 prose-blockquote:rounded-r-lg prose-blockquote:my-8 prose-ul:space-y-2 prose-ol:space-y-2 prose-li:text-gray-700 prose-table:border-collapse prose-table:border prose-table:border-gray-300 prose-th:border prose-th:border-gray-300 prose-th:bg-gray-50 prose-th:px-4 prose-th:py-2 prose-th:font-semibold prose-td:border prose-td:border-gray-300 prose-td:px-4 prose-td:py-2 prose-img:rounded-xl prose-img:shadow-md prose-img:mx-auto"> <h1 id="aws-and-azure-cloud-infrastructure-enterprise-migration-and-optimization-strategies">AWS and Azure Cloud Infrastructure: Enterprise Migration and Optimization Strategies</h1>
<p>Modern enterprises face increasing pressure to leverage cloud infrastructure for competitive advantage. Having worked extensively with cloud platforms across enterprise environments at EPAM Systems, FirstLine Software, and other organizations, I’ve witnessed how proper cloud architecture can transform business operations while reducing costs and improving reliability.</p>
<h2 id="the-strategic-value-of-cloud-infrastructure">The Strategic Value of Cloud Infrastructure</h2>
<p>Cloud adoption delivers measurable business outcomes when implemented correctly:</p>
<ul>
<li><strong>Scalability</strong>: Handle traffic growth from thousands to millions of users seamlessly</li>
<li><strong>Cost Efficiency</strong>: Optimize resource utilization and reduce infrastructure spending by 40-60%</li>
<li><strong>Global Reach</strong>: Deploy applications worldwide with minimal latency</li>
<li><strong>Reliability</strong>: Achieve 99.9%+ uptime through built-in redundancy and fault tolerance</li>
<li><strong>Innovation Velocity</strong>: Accelerate feature delivery and time-to-market</li>
</ul>
<p>Through my experience implementing cloud solutions, I’ve observed organizations achieve these benefits consistently when following proven architectural patterns and best practices.</p>
<h2 id="aws-vs-azure-platform-analysis">AWS vs Azure: Platform Analysis</h2>
<h3 id="aws-ecosystem-strengths">AWS Ecosystem Strengths</h3>
<ul>
<li><strong>Service Breadth</strong>: Most comprehensive cloud platform with 200+ services</li>
<li><strong>Market Maturity</strong>: Battle-tested infrastructure powering Netflix, Airbnb, and thousands of enterprises</li>
<li><strong>Global Infrastructure</strong>: 31 regions with extensive availability zone coverage</li>
<li><strong>Developer Ecosystem</strong>: Rich third-party integrations and community support</li>
</ul>
<h3 id="azure-platform-advantages">Azure Platform Advantages</h3>
<ul>
<li><strong>Microsoft Integration</strong>: Native Windows Server, Active Directory, and Office 365 connectivity</li>
<li><strong>Hybrid Capabilities</strong>: Seamless on-premises integration through Azure Arc and hybrid cloud solutions</li>
<li><strong>Enterprise Focus</strong>: Strong compliance, governance, and security features for regulated industries</li>
<li><strong>AI/ML Leadership</strong>: Advanced cognitive services and machine learning capabilities</li>
</ul>
<h3 id="multi-cloud-architecture-strategy">Multi-Cloud Architecture Strategy</h3>
<p>For enterprise deployments, a multi-cloud approach often provides optimal results:</p>
<ul>
<li><strong>Primary Platform</strong>: AWS for web applications and microservices</li>
<li><strong>Specialized Workloads</strong>: Azure for Microsoft-centric applications and enterprise systems</li>
<li><strong>Risk Mitigation</strong>: Avoid vendor lock-in while maintaining operational flexibility</li>
</ul>
<h2 id="enterprise-cloud-architecture-patterns">Enterprise Cloud Architecture Patterns</h2>
<h3 id="1-three-tier-application-architecture">1. Three-Tier Application Architecture</h3>
<p><strong>AWS Infrastructure Implementation</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># infrastructure/aws/vpc.tf</span></span>
<span class="line"><span style="color:#9ECBFF">resource "aws_vpc" "main" {</span></span>
<span class="line"><span style="color:#9ECBFF">  cidr_block           = "10.0.0.0/16"</span></span>
<span class="line"><span style="color:#9ECBFF">  enable_dns_hostnames = true</span></span>
<span class="line"><span style="color:#9ECBFF">  enable_dns_support   = true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Name        = "${var.project_name}-vpc"</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Application Load Balancer for high availability</span></span>
<span class="line"><span style="color:#9ECBFF">resource "aws_lb" "application" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name               = "${var.project_name}-alb"</span></span>
<span class="line"><span style="color:#9ECBFF">  internal           = false</span></span>
<span class="line"><span style="color:#9ECBFF">  load_balancer_type = "application"</span></span>
<span class="line"><span style="color:#9ECBFF">  security_groups    = [aws_security_group.alb.id]</span></span>
<span class="line"><span style="color:#9ECBFF">  subnets           = aws_subnet.public[*].id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  enable_deletion_protection = true</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  access_logs {</span></span>
<span class="line"><span style="color:#9ECBFF">    bucket  = aws_s3_bucket.alb_logs.bucket</span></span>
<span class="line"><span style="color:#9ECBFF">    prefix  = "alb-logs"</span></span>
<span class="line"><span style="color:#9ECBFF">    enabled = true</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Auto Scaling Group for elastic capacity</span></span>
<span class="line"><span style="color:#9ECBFF">resource "aws_autoscaling_group" "app" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name                = "${var.project_name}-asg"</span></span>
<span class="line"><span style="color:#9ECBFF">  vpc_zone_identifier = aws_subnet.private[*].id</span></span>
<span class="line"><span style="color:#9ECBFF">  target_group_arns   = [aws_lb_target_group.app.arn]</span></span>
<span class="line"><span style="color:#9ECBFF">  health_check_type   = "ELB"</span></span>
<span class="line"><span style="color:#9ECBFF">  health_check_grace_period = 300</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  min_size         = 2</span></span>
<span class="line"><span style="color:#9ECBFF">  max_size         = 20</span></span>
<span class="line"><span style="color:#9ECBFF">  desired_capacity = 3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  launch_template {</span></span>
<span class="line"><span style="color:#9ECBFF">    id      = aws_launch_template.app.id</span></span>
<span class="line"><span style="color:#9ECBFF">    version = "$Latest"</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  # Scaling policies for cost optimization</span></span>
<span class="line"><span style="color:#9ECBFF">  enabled_metrics = [</span></span>
<span class="line"><span style="color:#9ECBFF">    "GroupMinSize"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "GroupMaxSize"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "GroupDesiredCapacity"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "GroupInServiceInstances"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "GroupTotalInstances"</span></span>
<span class="line"><span style="color:#E1E4E8">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tag {</span></span>
<span class="line"><span style="color:#9ECBFF">    key                 = "Name"</span></span>
<span class="line"><span style="color:#9ECBFF">    value               = "${var.project_name}-app-server"</span></span>
<span class="line"><span style="color:#9ECBFF">    propagate_at_launch = true</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># RDS with Multi-AZ for high availability</span></span>
<span class="line"><span style="color:#9ECBFF">resource "aws_db_instance" "main" {</span></span>
<span class="line"><span style="color:#9ECBFF">  identifier     = "${var.project_name}-db"</span></span>
<span class="line"><span style="color:#9ECBFF">  engine         = "postgres"</span></span>
<span class="line"><span style="color:#9ECBFF">  engine_version = "15.4"</span></span>
<span class="line"><span style="color:#9ECBFF">  instance_class = "db.r6g.xlarge"</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  allocated_storage     = 100</span></span>
<span class="line"><span style="color:#9ECBFF">  max_allocated_storage = 1000</span></span>
<span class="line"><span style="color:#9ECBFF">  storage_type         = "gp3"</span></span>
<span class="line"><span style="color:#9ECBFF">  storage_encrypted    = true</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  db_name  = var.database_name</span></span>
<span class="line"><span style="color:#9ECBFF">  username = var.database_username</span></span>
<span class="line"><span style="color:#9ECBFF">  password = var.database_password</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  vpc_security_group_ids = [aws_security_group.rds.id]</span></span>
<span class="line"><span style="color:#9ECBFF">  db_subnet_group_name   = aws_db_subnet_group.main.name</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  backup_retention_period = 7</span></span>
<span class="line"><span style="color:#9ECBFF">  backup_window          = "03:00-04:00"</span></span>
<span class="line"><span style="color:#9ECBFF">  maintenance_window     = "Sun:04:00-Sun:05:00"</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  multi_az               = true</span></span>
<span class="line"><span style="color:#9ECBFF">  deletion_protection    = true</span></span>
<span class="line"><span style="color:#9ECBFF">  skip_final_snapshot    = false</span></span>
<span class="line"><span style="color:#9ECBFF">  final_snapshot_identifier = "${var.project_name}-final-snapshot"</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  performance_insights_enabled = true</span></span>
<span class="line"><span style="color:#9ECBFF">  monitoring_interval         = 60</span></span>
<span class="line"><span style="color:#9ECBFF">  monitoring_role_arn        = aws_iam_role.rds_monitoring.arn</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><strong>Azure Infrastructure Implementation</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># infrastructure/azure/main.tf</span></span>
<span class="line"><span style="color:#9ECBFF">resource "azurerm_resource_group" "main" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name     = "${var.project_name}-rg"</span></span>
<span class="line"><span style="color:#9ECBFF">  location = var.azure_region</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Virtual Network with proper segmentation</span></span>
<span class="line"><span style="color:#9ECBFF">resource "azurerm_virtual_network" "main" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name                = "${var.project_name}-vnet"</span></span>
<span class="line"><span style="color:#9ECBFF">  address_space       = ["10.0.0.0/16"]</span></span>
<span class="line"><span style="color:#9ECBFF">  location            = azurerm_resource_group.main.location</span></span>
<span class="line"><span style="color:#9ECBFF">  resource_group_name = azurerm_resource_group.main.name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Application Gateway for load balancing</span></span>
<span class="line"><span style="color:#9ECBFF">resource "azurerm_application_gateway" "main" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name                = "${var.project_name}-appgw"</span></span>
<span class="line"><span style="color:#9ECBFF">  resource_group_name = azurerm_resource_group.main.name</span></span>
<span class="line"><span style="color:#9ECBFF">  location           = azurerm_resource_group.main.location</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  sku {</span></span>
<span class="line"><span style="color:#9ECBFF">    name     = "Standard_v2"</span></span>
<span class="line"><span style="color:#9ECBFF">    tier     = "Standard_v2"</span></span>
<span class="line"><span style="color:#9ECBFF">    capacity = 2</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  autoscale_configuration {</span></span>
<span class="line"><span style="color:#9ECBFF">    min_capacity = 2</span></span>
<span class="line"><span style="color:#9ECBFF">    max_capacity = 10</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  gateway_ip_configuration {</span></span>
<span class="line"><span style="color:#9ECBFF">    name      = "gateway-ip-config"</span></span>
<span class="line"><span style="color:#9ECBFF">    subnet_id = azurerm_subnet.gateway.id</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  frontend_port {</span></span>
<span class="line"><span style="color:#9ECBFF">    name = "frontend-port-80"</span></span>
<span class="line"><span style="color:#9ECBFF">    port = 80</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  frontend_port {</span></span>
<span class="line"><span style="color:#9ECBFF">    name = "frontend-port-443"</span></span>
<span class="line"><span style="color:#9ECBFF">    port = 443</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  frontend_ip_configuration {</span></span>
<span class="line"><span style="color:#9ECBFF">    name                 = "frontend-ip-config"</span></span>
<span class="line"><span style="color:#9ECBFF">    public_ip_address_id = azurerm_public_ip.gateway.id</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  # SSL termination and security</span></span>
<span class="line"><span style="color:#9ECBFF">  ssl_certificate {</span></span>
<span class="line"><span style="color:#9ECBFF">    name     = "ssl-cert"</span></span>
<span class="line"><span style="color:#9ECBFF">    data     = filebase64("certificate.pfx")</span></span>
<span class="line"><span style="color:#9ECBFF">    password = var.ssl_password</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Virtual Machine Scale Set for elastic compute</span></span>
<span class="line"><span style="color:#9ECBFF">resource "azurerm_linux_virtual_machine_scale_set" "app" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name                = "${var.project_name}-vmss"</span></span>
<span class="line"><span style="color:#9ECBFF">  resource_group_name = azurerm_resource_group.main.name</span></span>
<span class="line"><span style="color:#9ECBFF">  location           = azurerm_resource_group.main.location</span></span>
<span class="line"><span style="color:#9ECBFF">  sku                = "Standard_D2s_v3"</span></span>
<span class="line"><span style="color:#9ECBFF">  instances          = 3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  admin_username = var.admin_username</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  disable_password_authentication = true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  admin_ssh_key {</span></span>
<span class="line"><span style="color:#9ECBFF">    username   = var.admin_username</span></span>
<span class="line"><span style="color:#9ECBFF">    public_key = file("~/.ssh/id_rsa.pub")</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  source_image_reference {</span></span>
<span class="line"><span style="color:#9ECBFF">    publisher = "Canonical"</span></span>
<span class="line"><span style="color:#9ECBFF">    offer     = "0001-com-ubuntu-server-focal"</span></span>
<span class="line"><span style="color:#9ECBFF">    sku       = "20_04-lts-gen2"</span></span>
<span class="line"><span style="color:#9ECBFF">    version   = "latest"</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  os_disk {</span></span>
<span class="line"><span style="color:#9ECBFF">    storage_account_type = "Premium_LRS"</span></span>
<span class="line"><span style="color:#9ECBFF">    caching             = "ReadWrite"</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  # Auto-scaling configuration</span></span>
<span class="line"><span style="color:#9ECBFF">  automatic_os_upgrade_policy {</span></span>
<span class="line"><span style="color:#9ECBFF">    disable_automatic_rollback  = false</span></span>
<span class="line"><span style="color:#9ECBFF">    enable_automatic_os_upgrade = true</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  upgrade_mode = "Automatic"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  network_interface {</span></span>
<span class="line"><span style="color:#9ECBFF">    name    = "internal"</span></span>
<span class="line"><span style="color:#9ECBFF">    primary = true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">    ip_configuration {</span></span>
<span class="line"><span style="color:#9ECBFF">      name      = "internal"</span></span>
<span class="line"><span style="color:#9ECBFF">      primary   = true</span></span>
<span class="line"><span style="color:#9ECBFF">      subnet_id = azurerm_subnet.app.id</span></span>
<span class="line"><span style="color:#9ECBFF">      load_balancer_backend_address_pool_ids = [</span></span>
<span class="line"><span style="color:#9ECBFF">        azurerm_lb_backend_address_pool.app.id</span></span>
<span class="line"><span style="color:#E1E4E8">      ]</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Azure Database for PostgreSQL with high availability</span></span>
<span class="line"><span style="color:#9ECBFF">resource "azurerm_postgresql_flexible_server" "main" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name                   = "${var.project_name}-psql"</span></span>
<span class="line"><span style="color:#9ECBFF">  resource_group_name    = azurerm_resource_group.main.name</span></span>
<span class="line"><span style="color:#9ECBFF">  location              = azurerm_resource_group.main.location</span></span>
<span class="line"><span style="color:#9ECBFF">  version               = "15"</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  administrator_login    = var.database_username</span></span>
<span class="line"><span style="color:#9ECBFF">  administrator_password = var.database_password</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  zone                   = "1"</span></span>
<span class="line"><span style="color:#9ECBFF">  high_availability {</span></span>
<span class="line"><span style="color:#9ECBFF">    mode = "ZoneRedundant"</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  storage_mb            = 32768</span></span>
<span class="line"><span style="color:#9ECBFF">  sku_name             = "GP_Standard_D2s_v3"</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  backup_retention_days = 35</span></span>
<span class="line"><span style="color:#9ECBFF">  geo_redundant_backup_enabled = true</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h3 id="2-microservices-with-container-orchestration">2. Microservices with Container Orchestration</h3>
<p><strong>Amazon EKS Configuration</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># kubernetes/aws/cluster.yaml</span></span>
<span class="line"><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">eksctl.io/v1alpha5</span></span>
<span class="line"><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ClusterConfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">production-cluster</span></span>
<span class="line"><span style="color:#85E89D">  region</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">us-west-2</span></span>
<span class="line"><span style="color:#85E89D">  version</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"1.28"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">iam</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  withOIDC</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">addons</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">vpc-cni</span></span>
<span class="line"><span style="color:#85E89D">    version</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">latest</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">coredns</span></span>
<span class="line"><span style="color:#85E89D">    version</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">latest</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">kube-proxy</span></span>
<span class="line"><span style="color:#85E89D">    version</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">latest</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">aws-ebs-csi-driver</span></span>
<span class="line"><span style="color:#85E89D">    version</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">nodeGroups</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">system-nodes</span></span>
<span class="line"><span style="color:#85E89D">    instanceType</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">t3.medium</span></span>
<span class="line"><span style="color:#85E89D">    minSize</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#85E89D">    maxSize</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3</span></span>
<span class="line"><span style="color:#85E89D">    desiredCapacity</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">2</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    volumeSize</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">50</span></span>
<span class="line"><span style="color:#85E89D">    volumeType</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">gp3</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    ssh</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      allow</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">false</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    iam</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      withAddonPolicies</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        autoScaler</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        cloudWatch</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        ebs</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        efs</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        albIngress</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    labels</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      node-type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">system</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    taints</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">key</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">node-type</span></span>
<span class="line"><span style="color:#85E89D">        value</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">system</span></span>
<span class="line"><span style="color:#85E89D">        effect</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">NoSchedule</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">application-nodes</span></span>
<span class="line"><span style="color:#85E89D">    instanceType</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">m5.large</span></span>
<span class="line"><span style="color:#85E89D">    minSize</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3</span></span>
<span class="line"><span style="color:#85E89D">    maxSize</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">20</span></span>
<span class="line"><span style="color:#85E89D">    desiredCapacity</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">5</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    volumeSize</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">100</span></span>
<span class="line"><span style="color:#85E89D">    volumeType</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">gp3</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    ssh</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      allow</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">false</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    iam</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      withAddonPolicies</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        autoScaler</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        cloudWatch</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        ebs</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        efs</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        albIngress</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    labels</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      node-type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">application</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">cloudWatch</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  clusterLogging</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    enableTypes</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"api"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"audit"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"authenticator"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"controllerManager"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"scheduler"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span></code></pre>
<p><strong>Azure AKS Setup</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># infrastructure/azure/aks.tf</span></span>
<span class="line"><span style="color:#9ECBFF">resource "azurerm_kubernetes_cluster" "main" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name                = "${var.project_name}-aks"</span></span>
<span class="line"><span style="color:#9ECBFF">  location            = azurerm_resource_group.main.location</span></span>
<span class="line"><span style="color:#9ECBFF">  resource_group_name = azurerm_resource_group.main.name</span></span>
<span class="line"><span style="color:#9ECBFF">  dns_prefix          = "${var.project_name}-aks"</span></span>
<span class="line"><span style="color:#9ECBFF">  kubernetes_version  = "1.28.3"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  default_node_pool {</span></span>
<span class="line"><span style="color:#9ECBFF">    name                = "system"</span></span>
<span class="line"><span style="color:#9ECBFF">    node_count          = 2</span></span>
<span class="line"><span style="color:#9ECBFF">    vm_size            = "Standard_D2s_v3"</span></span>
<span class="line"><span style="color:#9ECBFF">    os_disk_size_gb    = 50</span></span>
<span class="line"><span style="color:#9ECBFF">    vnet_subnet_id     = azurerm_subnet.aks.id</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#9ECBFF">    enable_auto_scaling = true</span></span>
<span class="line"><span style="color:#9ECBFF">    min_count          = 2</span></span>
<span class="line"><span style="color:#9ECBFF">    max_count          = 5</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#9ECBFF">    node_labels = {</span></span>
<span class="line"><span style="color:#9ECBFF">      "node-type"</span><span style="color:#9ECBFF"> = "system"</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#9ECBFF">    node_taints = [</span></span>
<span class="line"><span style="color:#9ECBFF">      "CriticalAddonsOnly=true:NoSchedule"</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  identity {</span></span>
<span class="line"><span style="color:#9ECBFF">    type = "SystemAssigned"</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  network_profile {</span></span>
<span class="line"><span style="color:#9ECBFF">    network_plugin = "azure"</span></span>
<span class="line"><span style="color:#9ECBFF">    network_policy = "azure"</span></span>
<span class="line"><span style="color:#9ECBFF">    service_cidr   = "10.1.0.0/16"</span></span>
<span class="line"><span style="color:#9ECBFF">    dns_service_ip = "10.1.0.10"</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  # Security and compliance features</span></span>
<span class="line"><span style="color:#9ECBFF">  azure_policy_enabled             = true</span></span>
<span class="line"><span style="color:#9ECBFF">  open_service_mesh_enabled        = true</span></span>
<span class="line"><span style="color:#9ECBFF">  key_vault_secrets_provider {</span></span>
<span class="line"><span style="color:#9ECBFF">    secret_rotation_enabled = true</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#6A737D">  # Monitoring and observability</span></span>
<span class="line"><span style="color:#9ECBFF">  oms_agent {</span></span>
<span class="line"><span style="color:#9ECBFF">    log_analytics_workspace_id = azurerm_log_analytics_workspace.main.id</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Additional node pool for applications</span></span>
<span class="line"><span style="color:#9ECBFF">resource "azurerm_kubernetes_cluster_node_pool" "applications" {</span></span>
<span class="line"><span style="color:#9ECBFF">  name                  = "apps"</span></span>
<span class="line"><span style="color:#9ECBFF">  kubernetes_cluster_id = azurerm_kubernetes_cluster.main.id</span></span>
<span class="line"><span style="color:#9ECBFF">  vm_size              = "Standard_D4s_v3"</span></span>
<span class="line"><span style="color:#9ECBFF">  node_count           = 3</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  enable_auto_scaling = true</span></span>
<span class="line"><span style="color:#9ECBFF">  min_count          = 3</span></span>
<span class="line"><span style="color:#9ECBFF">  max_count          = 20</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  vnet_subnet_id = azurerm_subnet.aks.id</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#9ECBFF">  node_labels = {</span></span>
<span class="line"><span style="color:#9ECBFF">    "node-type"</span><span style="color:#9ECBFF"> = "application"</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  tags = {</span></span>
<span class="line"><span style="color:#9ECBFF">    Environment = var.environment</span></span>
<span class="line"><span style="color:#9ECBFF">    Project     = var.project_name</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h2 id="production-ready-application-deployment">Production-Ready Application Deployment</h2>
<h3 id="helm-chart-configuration">Helm Chart Configuration</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># helm/microservice/values.yaml</span></span>
<span class="line"><span style="color:#85E89D">replicaCount</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">image</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  repository</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">your-registry/api</span></span>
<span class="line"><span style="color:#85E89D">  tag</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"1.0.0"</span></span>
<span class="line"><span style="color:#85E89D">  pullPolicy</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">IfNotPresent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">nameOverride</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">""</span></span>
<span class="line"><span style="color:#85E89D">fullnameOverride</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">serviceAccount</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  create</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">  annotations</span><span style="color:#E1E4E8">: {}</span></span>
<span class="line"><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">podAnnotations</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  prometheus.io/scrape</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"true"</span></span>
<span class="line"><span style="color:#85E89D">  prometheus.io/port</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"3000"</span></span>
<span class="line"><span style="color:#85E89D">  prometheus.io/path</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"/metrics"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">podSecurityContext</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  fsGroup</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">2000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">securityContext</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  capabilities</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    drop</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#9ECBFF">ALL</span></span>
<span class="line"><span style="color:#85E89D">  readOnlyRootFilesystem</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">  runAsNonRoot</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">  runAsUser</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">service</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ClusterIP</span></span>
<span class="line"><span style="color:#85E89D">  port</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">80</span></span>
<span class="line"><span style="color:#85E89D">  targetPort</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">ingress</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  enabled</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">  className</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"nginx"</span></span>
<span class="line"><span style="color:#85E89D">  annotations</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    nginx.ingress.kubernetes.io/ssl-redirect</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"true"</span></span>
<span class="line"><span style="color:#85E89D">    nginx.ingress.kubernetes.io/use-regex</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"true"</span></span>
<span class="line"><span style="color:#85E89D">    cert-manager.io/cluster-issuer</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"letsencrypt-prod"</span></span>
<span class="line"><span style="color:#85E89D">    nginx.ingress.kubernetes.io/rate-limit</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"100"</span></span>
<span class="line"><span style="color:#85E89D">  hosts</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#85E89D">host</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">api.yourdomain.com</span></span>
<span class="line"><span style="color:#85E89D">      paths</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        - </span><span style="color:#85E89D">path</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">/</span></span>
<span class="line"><span style="color:#85E89D">          pathType</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Prefix</span></span>
<span class="line"><span style="color:#85E89D">  tls</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#85E89D">secretName</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">api-tls</span></span>
<span class="line"><span style="color:#85E89D">      hosts</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        - </span><span style="color:#9ECBFF">api.yourdomain.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">resources</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  limits</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    cpu</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">1000m</span></span>
<span class="line"><span style="color:#85E89D">    memory</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">1Gi</span></span>
<span class="line"><span style="color:#85E89D">  requests</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    cpu</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">500m</span></span>
<span class="line"><span style="color:#85E89D">    memory</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">512Mi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">autoscaling</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  enabled</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">  minReplicas</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3</span></span>
<span class="line"><span style="color:#85E89D">  maxReplicas</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">50</span></span>
<span class="line"><span style="color:#85E89D">  targetCPUUtilizationPercentage</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">70</span></span>
<span class="line"><span style="color:#85E89D">  targetMemoryUtilizationPercentage</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Node affinity for optimal placement</span></span>
<span class="line"><span style="color:#85E89D">nodeSelector</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  node-type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">application</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">tolerations</span><span style="color:#E1E4E8">: []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">affinity</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  podAntiAffinity</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#85E89D">weight</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">100</span></span>
<span class="line"><span style="color:#85E89D">      podAffinityTerm</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        labelSelector</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          matchExpressions</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">          - </span><span style="color:#85E89D">key</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">app.kubernetes.io/name</span></span>
<span class="line"><span style="color:#85E89D">            operator</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">In</span></span>
<span class="line"><span style="color:#85E89D">            values</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">api</span></span>
<span class="line"><span style="color:#85E89D">        topologyKey</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">kubernetes.io/hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Health checks</span></span>
<span class="line"><span style="color:#85E89D">livenessProbe</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  httpGet</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    path</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">/health</span></span>
<span class="line"><span style="color:#85E89D">    port</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">http</span></span>
<span class="line"><span style="color:#85E89D">  initialDelaySeconds</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">30</span></span>
<span class="line"><span style="color:#85E89D">  periodSeconds</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">readinessProbe</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  httpGet</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    path</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">/ready</span></span>
<span class="line"><span style="color:#85E89D">    port</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">http</span></span>
<span class="line"><span style="color:#85E89D">  initialDelaySeconds</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">5</span></span>
<span class="line"><span style="color:#85E89D">  periodSeconds</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Environment configuration</span></span>
<span class="line"><span style="color:#85E89D">env</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">NODE_ENV</span></span>
<span class="line"><span style="color:#85E89D">    value</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"production"</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">DATABASE_URL</span></span>
<span class="line"><span style="color:#85E89D">    valueFrom</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      secretKeyRef</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">database-credentials</span></span>
<span class="line"><span style="color:#85E89D">        key</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">url</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">REDIS_URL</span></span>
<span class="line"><span style="color:#85E89D">    valueFrom</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      secretKeyRef</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">redis-credentials</span></span>
<span class="line"><span style="color:#85E89D">        key</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">url</span></span>
<span class="line"></span></code></pre>
<h3 id="container-security-best-practices">Container Security Best Practices</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="dockerfile"><code><span class="line"><span style="color:#6A737D"># Multi-stage build for security and efficiency</span></span>
<span class="line"><span style="color:#F97583">FROM</span><span style="color:#E1E4E8"> node:18-alpine </span><span style="color:#F97583">AS</span><span style="color:#E1E4E8"> dependencies</span></span>
<span class="line"><span style="color:#F97583">WORKDIR</span><span style="color:#E1E4E8"> /app</span></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> package*.json ./</span></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> npm ci --only=production &#x26;&#x26; npm cache clean --force</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">FROM</span><span style="color:#E1E4E8"> node:18-alpine </span><span style="color:#F97583">AS</span><span style="color:#E1E4E8"> build</span></span>
<span class="line"><span style="color:#F97583">WORKDIR</span><span style="color:#E1E4E8"> /app</span></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> package*.json ./</span></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> npm ci</span></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> . .</span></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Production stage with minimal attack surface</span></span>
<span class="line"><span style="color:#F97583">FROM</span><span style="color:#E1E4E8"> node:18-alpine </span><span style="color:#F97583">AS</span><span style="color:#E1E4E8"> production</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Security: Create non-root user</span></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> addgroup -g 1001 -S nodejs &#x26;&#x26; \</span></span>
<span class="line"><span style="color:#E1E4E8">    adduser -S appuser -u 1001 -G nodejs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Security: Update packages and remove package manager</span></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> apk update &#x26;&#x26; apk upgrade &#x26;&#x26; \</span></span>
<span class="line"><span style="color:#E1E4E8">    apk add --no-cache dumb-init &#x26;&#x26; \</span></span>
<span class="line"><span style="color:#E1E4E8">    rm -rf /var/cache/apk/*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">WORKDIR</span><span style="color:#E1E4E8"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Copy built application with proper ownership</span></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> --from=build --chown=appuser:nodejs /app/dist ./dist</span></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> --from=dependencies --chown=appuser:nodejs /app/node_modules ./node_modules</span></span>
<span class="line"><span style="color:#F97583">COPY</span><span style="color:#E1E4E8"> --from=build --chown=appuser:nodejs /app/package.json ./package.json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Security: Remove write permissions</span></span>
<span class="line"><span style="color:#F97583">RUN</span><span style="color:#E1E4E8"> chmod -R 555 /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Switch to non-root user</span></span>
<span class="line"><span style="color:#F97583">USER</span><span style="color:#E1E4E8"> appuser</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Health check for container orchestration</span></span>
<span class="line"><span style="color:#F97583">HEALTHCHECK</span><span style="color:#E1E4E8"> --interval=30s --timeout=3s --start-period=5s --retries=3 \</span></span>
<span class="line"><span style="color:#F97583">  CMD</span><span style="color:#E1E4E8"> wget --no-verbose --tries=1 --spider http://localhost:3000/health || exit 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Use dumb-init for proper signal handling</span></span>
<span class="line"><span style="color:#F97583">ENTRYPOINT</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"dumb-init"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"--"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Expose port (documentation only)</span></span>
<span class="line"><span style="color:#F97583">EXPOSE</span><span style="color:#E1E4E8"> 3000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Start application</span></span>
<span class="line"><span style="color:#F97583">CMD</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"node"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"dist/index.js"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span></code></pre>
<h2 id="cicd-pipeline-implementation">CI/CD Pipeline Implementation</h2>
<h3 id="github-actions-workflow">GitHub Actions Workflow</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># .github/workflows/deploy.yml</span></span>
<span class="line"><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Deploy to Production</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">on</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  push</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    branches</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">main</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#85E89D">  pull_request</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    branches</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">main</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">env</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  REGISTRY</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ghcr.io</span></span>
<span class="line"><span style="color:#85E89D">  IMAGE_NAME</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ github.repository }}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">jobs</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  security-scan</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    runs-on</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ubuntu-latest</span></span>
<span class="line"><span style="color:#85E89D">    steps</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">actions/checkout@v4</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Run security scan</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">securecodewarrior/github-action-add-sarif@v1</span></span>
<span class="line"><span style="color:#85E89D">        with</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          sarif-file</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'security-scan-results.sarif'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  test</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    runs-on</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ubuntu-latest</span></span>
<span class="line"><span style="color:#85E89D">    services</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      postgres</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">postgres:15</span></span>
<span class="line"><span style="color:#85E89D">        env</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          POSTGRES_PASSWORD</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">postgres</span></span>
<span class="line"><span style="color:#85E89D">        options</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">>-</span></span>
<span class="line"><span style="color:#9ECBFF">          --health-cmd pg_isready</span></span>
<span class="line"><span style="color:#9ECBFF">          --health-interval 10s</span></span>
<span class="line"><span style="color:#9ECBFF">          --health-timeout 5s</span></span>
<span class="line"><span style="color:#9ECBFF">          --health-retries 5</span></span>
<span class="line"><span style="color:#9ECBFF">    </span></span>
<span class="line"><span style="color:#85E89D">    steps</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">actions/checkout@v4</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Setup Node.js</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">actions/setup-node@v4</span></span>
<span class="line"><span style="color:#85E89D">        with</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          node-version</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'18'</span></span>
<span class="line"><span style="color:#85E89D">          cache</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'npm'</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Install dependencies</span></span>
<span class="line"><span style="color:#85E89D">        run</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">npm ci</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Run unit tests</span></span>
<span class="line"><span style="color:#85E89D">        run</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">npm test</span></span>
<span class="line"><span style="color:#85E89D">        env</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          DATABASE_URL</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">postgresql://postgres:postgres@localhost:5432/test</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Run integration tests</span></span>
<span class="line"><span style="color:#85E89D">        run</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">npm run test:integration</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Generate coverage report</span></span>
<span class="line"><span style="color:#85E89D">        run</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">npm run coverage</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Upload coverage to Codecov</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">codecov/codecov-action@v3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  build-and-push</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    needs</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">security-scan</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">test</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#85E89D">    runs-on</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ubuntu-latest</span></span>
<span class="line"><span style="color:#85E89D">    permissions</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      contents</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">read</span></span>
<span class="line"><span style="color:#85E89D">      packages</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">write</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    steps</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Checkout</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">actions/checkout@v4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Log in to Container Registry</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">docker/login-action@v3</span></span>
<span class="line"><span style="color:#85E89D">        with</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          registry</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ env.REGISTRY }}</span></span>
<span class="line"><span style="color:#85E89D">          username</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ github.actor }}</span></span>
<span class="line"><span style="color:#85E89D">          password</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Extract metadata</span></span>
<span class="line"><span style="color:#85E89D">        id</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">meta</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">docker/metadata-action@v5</span></span>
<span class="line"><span style="color:#85E89D">        with</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          images</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}</span></span>
<span class="line"><span style="color:#85E89D">          tags</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">|</span></span>
<span class="line"><span style="color:#9ECBFF">            type=ref,event=branch</span></span>
<span class="line"><span style="color:#9ECBFF">            type=ref,event=pr</span></span>
<span class="line"><span style="color:#9ECBFF">            type=sha,prefix={{branch}}-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Build and push image</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">docker/build-push-action@v5</span></span>
<span class="line"><span style="color:#85E89D">        with</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          context</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">.</span></span>
<span class="line"><span style="color:#85E89D">          push</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">          tags</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ steps.meta.outputs.tags }}</span></span>
<span class="line"><span style="color:#85E89D">          labels</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ steps.meta.outputs.labels }}</span></span>
<span class="line"><span style="color:#85E89D">          cache-from</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">type=gha</span></span>
<span class="line"><span style="color:#85E89D">          cache-to</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">type=gha,mode=max</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  deploy</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    needs</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">build-and-push</span></span>
<span class="line"><span style="color:#85E89D">    runs-on</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ubuntu-latest</span></span>
<span class="line"><span style="color:#85E89D">    if</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">github.ref == 'refs/heads/main'</span></span>
<span class="line"><span style="color:#85E89D">    environment</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">production</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    steps</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Checkout</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">actions/checkout@v4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Configure AWS credentials</span></span>
<span class="line"><span style="color:#85E89D">        uses</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">aws-actions/configure-aws-credentials@v4</span></span>
<span class="line"><span style="color:#85E89D">        with</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          aws-access-key-id</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ secrets.AWS_ACCESS_KEY_ID }}</span></span>
<span class="line"><span style="color:#85E89D">          aws-secret-access-key</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span></span>
<span class="line"><span style="color:#85E89D">          aws-region</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">us-west-2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Update kubeconfig</span></span>
<span class="line"><span style="color:#85E89D">        run</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">|</span></span>
<span class="line"><span style="color:#9ECBFF">          aws eks update-kubeconfig --region us-west-2 --name production-cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Deploy to Kubernetes</span></span>
<span class="line"><span style="color:#85E89D">        run</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">|</span></span>
<span class="line"><span style="color:#9ECBFF">          helm upgrade --install api ./helm/microservice \</span></span>
<span class="line"><span style="color:#9ECBFF">            --set image.tag=${{ github.sha }} \</span></span>
<span class="line"><span style="color:#9ECBFF">            --namespace production \</span></span>
<span class="line"><span style="color:#9ECBFF">            --create-namespace \</span></span>
<span class="line"><span style="color:#9ECBFF">            --wait \</span></span>
<span class="line"><span style="color:#9ECBFF">            --timeout=10m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Verify deployment</span></span>
<span class="line"><span style="color:#85E89D">        run</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">|</span></span>
<span class="line"><span style="color:#9ECBFF">          kubectl rollout status deployment/api -n production --timeout=300s</span></span>
<span class="line"><span style="color:#9ECBFF">          kubectl get pods -n production -l app.kubernetes.io/name=api</span></span>
<span class="line"></span></code></pre>
<h2 id="monitoring-and-observability">Monitoring and Observability</h2>
<h3 id="prometheus-configuration">Prometheus Configuration</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># monitoring/prometheus/values.yaml</span></span>
<span class="line"><span style="color:#85E89D">prometheus</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  prometheusSpec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    retention</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">30d</span></span>
<span class="line"><span style="color:#85E89D">    resources</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      requests</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        cpu</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">500m</span></span>
<span class="line"><span style="color:#85E89D">        memory</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">2Gi</span></span>
<span class="line"><span style="color:#85E89D">      limits</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        cpu</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">2000m</span></span>
<span class="line"><span style="color:#85E89D">        memory</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">8Gi</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#85E89D">    storageSpec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      volumeClaimTemplate</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          storageClassName</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">gp3</span></span>
<span class="line"><span style="color:#85E89D">          accessModes</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"ReadWriteOnce"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#85E89D">          resources</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">            requests</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">              storage</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">50Gi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">alertmanager</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  alertmanagerSpec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    resources</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      requests</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        cpu</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">100m</span></span>
<span class="line"><span style="color:#85E89D">        memory</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">256Mi</span></span>
<span class="line"><span style="color:#85E89D">      limits</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        cpu</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">500m</span></span>
<span class="line"><span style="color:#85E89D">        memory</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">512Mi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">grafana</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  adminPassword</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">${{ secrets.GRAFANA_PASSWORD }}</span></span>
<span class="line"><span style="color:#85E89D">  resources</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    requests</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      cpu</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">250m</span></span>
<span class="line"><span style="color:#85E89D">      memory</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">512Mi</span></span>
<span class="line"><span style="color:#85E89D">    limits</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      cpu</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">500m</span></span>
<span class="line"><span style="color:#85E89D">      memory</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">1Gi</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#85E89D">  dashboardProviders</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    dashboardproviders.yaml</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#85E89D">      providers</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'custom-dashboards'</span></span>
<span class="line"><span style="color:#85E89D">        folder</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">''</span></span>
<span class="line"><span style="color:#85E89D">        type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">file</span></span>
<span class="line"><span style="color:#85E89D">        disableDeletion</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">false</span></span>
<span class="line"><span style="color:#85E89D">        editable</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#85E89D">        options</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          path</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">/var/lib/grafana/dashboards</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  dashboards</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    custom-dashboards</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      node-exporter</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        gnetId</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1860</span></span>
<span class="line"><span style="color:#85E89D">        revision</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">27</span></span>
<span class="line"><span style="color:#85E89D">        datasource</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Prometheus</span></span>
<span class="line"><span style="color:#85E89D">      kubernetes-cluster</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        gnetId</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">7249</span></span>
<span class="line"><span style="color:#85E89D">        revision</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#85E89D">        datasource</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">Prometheus</span></span>
<span class="line"></span></code></pre>
<h3 id="application-metrics">Application Metrics</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// monitoring/metrics.ts</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> promClient </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'prom-client'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Create a Registry which registers the metrics</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> register</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> promClient.</span><span style="color:#B392F0">Registry</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Add default metrics</span></span>
<span class="line"><span style="color:#E1E4E8">promClient.</span><span style="color:#B392F0">collectDefaultMetrics</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  register,</span></span>
<span class="line"><span style="color:#E1E4E8">  gcDurationBuckets: [</span><span style="color:#79B8FF">0.001</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.01</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Custom business metrics</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> httpRequestDuration</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> promClient.</span><span style="color:#B392F0">Histogram</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">'http_request_duration_seconds'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  help: </span><span style="color:#9ECBFF">'Duration of HTTP requests in seconds'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  labelNames: [</span><span style="color:#9ECBFF">'method'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'route'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'status_code'</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  buckets: [</span><span style="color:#79B8FF">0.001</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.005</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.015</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.05</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.3</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.4</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5.0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  registers: [register],</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> httpRequestsTotal</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> promClient.</span><span style="color:#B392F0">Counter</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">'http_requests_total'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  help: </span><span style="color:#9ECBFF">'Total number of HTTP requests'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  labelNames: [</span><span style="color:#9ECBFF">'method'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'route'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'status_code'</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  registers: [register],</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> activeConnections</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> promClient.</span><span style="color:#B392F0">Gauge</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">'active_connections'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  help: </span><span style="color:#9ECBFF">'Number of active connections'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  registers: [register],</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> databaseQueryDuration</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> promClient.</span><span style="color:#B392F0">Histogram</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">'database_query_duration_seconds'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  help: </span><span style="color:#9ECBFF">'Duration of database queries in seconds'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  labelNames: [</span><span style="color:#9ECBFF">'operation'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'table'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'status'</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  buckets: [</span><span style="color:#79B8FF">0.001</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.005</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.01</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.05</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5.0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  registers: [register],</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Business metrics</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> ordersTotal</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> promClient.</span><span style="color:#B392F0">Counter</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">'orders_total'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  help: </span><span style="color:#9ECBFF">'Total number of orders processed'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  labelNames: [</span><span style="color:#9ECBFF">'status'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'payment_method'</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  registers: [register],</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> revenueTotal</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> promClient.</span><span style="color:#B392F0">Gauge</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">'revenue_total_dollars'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  help: </span><span style="color:#9ECBFF">'Total revenue in dollars'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  registers: [register],</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  register,</span></span>
<span class="line"><span style="color:#E1E4E8">  httpRequestDuration,</span></span>
<span class="line"><span style="color:#E1E4E8">  httpRequestsTotal,</span></span>
<span class="line"><span style="color:#E1E4E8">  activeConnections,</span></span>
<span class="line"><span style="color:#E1E4E8">  databaseQueryDuration,</span></span>
<span class="line"><span style="color:#E1E4E8">  ordersTotal,</span></span>
<span class="line"><span style="color:#E1E4E8">  revenueTotal,</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<h2 id="cost-optimization-strategies">Cost Optimization Strategies</h2>
<h3 id="resource-right-sizing">Resource Right-Sizing</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#6A737D"># scripts/cost-optimization.py</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> boto3</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> json</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> datetime </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> datetime, timedelta</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> typing </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> List, Dict</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> CloudCostOptimizer</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#79B8FF"> __init__</span><span style="color:#E1E4E8">(self, region: </span><span style="color:#79B8FF">str</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> 'us-west-2'</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.ec2 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> boto3.client(</span><span style="color:#9ECBFF">'ec2'</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">region_name</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">region)</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.cloudwatch </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> boto3.client(</span><span style="color:#9ECBFF">'cloudwatch'</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">region_name</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">region)</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.cost_explorer </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> boto3.client(</span><span style="color:#9ECBFF">'ce'</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">region_name</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'us-east-1'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> analyze_ec2_utilization</span><span style="color:#E1E4E8">(self, days: </span><span style="color:#79B8FF">int</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 14</span><span style="color:#E1E4E8">) -> List[Dict]:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Analyze EC2 instance utilization and provide rightsizing recommendations"""</span></span>
<span class="line"><span style="color:#E1E4E8">        instances </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.ec2.describe_instances(</span></span>
<span class="line"><span style="color:#FFAB70">            Filters</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[{</span><span style="color:#9ECBFF">'Name'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'instance-state-name'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'Values'</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">'running'</span><span style="color:#E1E4E8">]}]</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        recommendations </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> reservation </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> instances[</span><span style="color:#9ECBFF">'Reservations'</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> instance </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> reservation[</span><span style="color:#9ECBFF">'Instances'</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#E1E4E8">                instance_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> instance[</span><span style="color:#9ECBFF">'InstanceId'</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">                instance_type </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> instance[</span><span style="color:#9ECBFF">'InstanceType'</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#E1E4E8">                metrics </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">._get_instance_metrics(instance_id, days)</span></span>
<span class="line"><span style="color:#E1E4E8">                recommendation </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">._generate_rightsizing_recommendation(</span></span>
<span class="line"><span style="color:#E1E4E8">                    instance_id, instance_type, metrics</span></span>
<span class="line"><span style="color:#E1E4E8">                )</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> recommendation:</span></span>
<span class="line"><span style="color:#E1E4E8">                    recommendations.append(recommendation)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> recommendations</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _get_instance_metrics</span><span style="color:#E1E4E8">(self, instance_id: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">, days: </span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">) -> Dict:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Get CloudWatch metrics for an instance"""</span></span>
<span class="line"><span style="color:#E1E4E8">        end_time </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> datetime.utcnow()</span></span>
<span class="line"><span style="color:#E1E4E8">        start_time </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> end_time </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> timedelta(</span><span style="color:#FFAB70">days</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">days)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        cpu_response </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.cloudwatch.get_metric_statistics(</span></span>
<span class="line"><span style="color:#FFAB70">            Namespace</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'AWS/EC2'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            MetricName</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'CPUUtilization'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            Dimensions</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[{</span><span style="color:#9ECBFF">'Name'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'InstanceId'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'Value'</span><span style="color:#E1E4E8">: instance_id}],</span></span>
<span class="line"><span style="color:#FFAB70">            StartTime</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">start_time,</span></span>
<span class="line"><span style="color:#FFAB70">            EndTime</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">end_time,</span></span>
<span class="line"><span style="color:#FFAB70">            Period</span><span style="color:#F97583">=</span><span style="color:#79B8FF">3600</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            Statistics</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">'Average'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'Maximum'</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        memory_response </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.cloudwatch.get_metric_statistics(</span></span>
<span class="line"><span style="color:#FFAB70">            Namespace</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'CWAgent'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            MetricName</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'mem_used_percent'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            Dimensions</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[{</span><span style="color:#9ECBFF">'Name'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'InstanceId'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'Value'</span><span style="color:#E1E4E8">: instance_id}],</span></span>
<span class="line"><span style="color:#FFAB70">            StartTime</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">start_time,</span></span>
<span class="line"><span style="color:#FFAB70">            EndTime</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">end_time,</span></span>
<span class="line"><span style="color:#FFAB70">            Period</span><span style="color:#F97583">=</span><span style="color:#79B8FF">3600</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            Statistics</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">'Average'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'Maximum'</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        cpu_avg </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> sum</span><span style="color:#E1E4E8">(point[</span><span style="color:#9ECBFF">'Average'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> point </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> cpu_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(cpu_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> cpu_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">else</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#E1E4E8">        cpu_max </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> max</span><span style="color:#E1E4E8">(point[</span><span style="color:#9ECBFF">'Maximum'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> point </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> cpu_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> cpu_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">else</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        memory_avg </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> sum</span><span style="color:#E1E4E8">(point[</span><span style="color:#9ECBFF">'Average'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> point </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> memory_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(memory_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> memory_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">else</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#E1E4E8">        memory_max </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> max</span><span style="color:#E1E4E8">(point[</span><span style="color:#9ECBFF">'Maximum'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> point </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> memory_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> memory_response[</span><span style="color:#9ECBFF">'Datapoints'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">else</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">            'cpu_average'</span><span style="color:#E1E4E8">: cpu_avg,</span></span>
<span class="line"><span style="color:#9ECBFF">            'cpu_maximum'</span><span style="color:#E1E4E8">: cpu_max,</span></span>
<span class="line"><span style="color:#9ECBFF">            'memory_average'</span><span style="color:#E1E4E8">: memory_avg,</span></span>
<span class="line"><span style="color:#9ECBFF">            'memory_maximum'</span><span style="color:#E1E4E8">: memory_max</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _generate_rightsizing_recommendation</span><span style="color:#E1E4E8">(self, instance_id: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">, instance_type: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">, metrics: Dict) -> Dict:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Generate rightsizing recommendation based on metrics"""</span></span>
<span class="line"><span style="color:#E1E4E8">        cpu_avg </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> metrics[</span><span style="color:#9ECBFF">'cpu_average'</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        cpu_max </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> metrics[</span><span style="color:#9ECBFF">'cpu_maximum'</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        memory_avg </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> metrics[</span><span style="color:#9ECBFF">'memory_average'</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        memory_max </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> metrics[</span><span style="color:#9ECBFF">'memory_maximum'</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Define thresholds for rightsizing</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> cpu_avg </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 20</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> cpu_max </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 50</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> memory_avg </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 50</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">            # Underutilized - recommend smaller instance</span></span>
<span class="line"><span style="color:#E1E4E8">            recommendation_type </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'downsize'</span></span>
<span class="line"><span style="color:#E1E4E8">            new_instance_type </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">._get_smaller_instance_type(instance_type)</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> cpu_avg </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 80</span><span style="color:#F97583"> or</span><span style="color:#E1E4E8"> cpu_max </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 95</span><span style="color:#F97583"> or</span><span style="color:#E1E4E8"> memory_avg </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 85</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">            # Overutilized - recommend larger instance</span></span>
<span class="line"><span style="color:#E1E4E8">            recommendation_type </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'upsize'</span></span>
<span class="line"><span style="color:#E1E4E8">            new_instance_type </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">._get_larger_instance_type(instance_type)</span></span>
<span class="line"><span style="color:#F97583">        else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">            # Properly sized</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> None</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">            'instance_id'</span><span style="color:#E1E4E8">: instance_id,</span></span>
<span class="line"><span style="color:#9ECBFF">            'current_type'</span><span style="color:#E1E4E8">: instance_type,</span></span>
<span class="line"><span style="color:#9ECBFF">            'recommended_type'</span><span style="color:#E1E4E8">: new_instance_type,</span></span>
<span class="line"><span style="color:#9ECBFF">            'recommendation_type'</span><span style="color:#E1E4E8">: recommendation_type,</span></span>
<span class="line"><span style="color:#9ECBFF">            'cpu_utilization'</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#9ECBFF">                'average'</span><span style="color:#E1E4E8">: cpu_avg,</span></span>
<span class="line"><span style="color:#9ECBFF">                'maximum'</span><span style="color:#E1E4E8">: cpu_max</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#9ECBFF">            'memory_utilization'</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#9ECBFF">                'average'</span><span style="color:#E1E4E8">: memory_avg,</span></span>
<span class="line"><span style="color:#9ECBFF">                'maximum'</span><span style="color:#E1E4E8">: memory_max</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#9ECBFF">            'estimated_savings'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">._calculate_cost_savings(instance_type, new_instance_type)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _get_smaller_instance_type</span><span style="color:#E1E4E8">(self, current_type: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">) -> </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Get smaller instance type recommendation"""</span></span>
<span class="line"><span style="color:#E1E4E8">        downsize_map </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.large'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'m5.medium'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'m5.large'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.2xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'m5.xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.4xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'m5.2xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.large'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'t3.medium'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'t3.large'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.2xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'t3.xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.large'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'c5.medium'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'c5.large'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.2xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'c5.xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> downsize_map.get(current_type, current_type)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _get_larger_instance_type</span><span style="color:#E1E4E8">(self, current_type: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">) -> </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Get larger instance type recommendation"""</span></span>
<span class="line"><span style="color:#E1E4E8">        upsize_map </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.medium'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'m5.large'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.large'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'m5.xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'m5.2xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.2xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'m5.4xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.medium'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'t3.large'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.large'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'t3.xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'t3.2xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.medium'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'c5.large'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.large'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'c5.xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'c5.2xlarge'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> upsize_map.get(current_type, current_type)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _calculate_cost_savings</span><span style="color:#E1E4E8">(self, current_type: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">, recommended_type: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">) -> </span><span style="color:#79B8FF">float</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Calculate estimated monthly cost savings"""</span></span>
<span class="line"><span style="color:#6A737D">        # Simplified pricing (actual pricing varies by region and usage)</span></span>
<span class="line"><span style="color:#E1E4E8">        instance_pricing </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.medium'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">33.41</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.large'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">66.82</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">133.63</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            't3.2xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">267.26</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.medium'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">43.83</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.large'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">87.66</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">175.32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.2xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">350.64</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'm5.4xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">701.28</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.medium'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">38.69</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.large'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">77.38</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">154.76</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            'c5.2xlarge'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">309.52</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        current_cost </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> instance_pricing.get(current_type, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        recommended_cost </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> instance_pricing.get(recommended_type, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> current_cost </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> recommended_cost</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Usage example</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#79B8FF"> __name__</span><span style="color:#F97583"> ==</span><span style="color:#9ECBFF"> "__main__"</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    optimizer </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> CloudCostOptimizer()</span></span>
<span class="line"><span style="color:#E1E4E8">    recommendations </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> optimizer.analyze_ec2_utilization(</span><span style="color:#FFAB70">days</span><span style="color:#F97583">=</span><span style="color:#79B8FF">14</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    total_potential_savings </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> sum</span><span style="color:#E1E4E8">(rec[</span><span style="color:#9ECBFF">'estimated_savings'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> rec </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> recommendations)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Found </span><span style="color:#79B8FF">{len</span><span style="color:#E1E4E8">(recommendations)</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> rightsizing opportunities"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Total potential monthly savings: $</span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">total_potential_savings</span><span style="color:#F97583">:.2f</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> rec </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> recommendations:</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Instance </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">rec[</span><span style="color:#9ECBFF">'instance_id'</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">: </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">rec[</span><span style="color:#9ECBFF">'current_type'</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> -> </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">rec[</span><span style="color:#9ECBFF">'recommended_type'</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> ($</span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">rec[</span><span style="color:#9ECBFF">'estimated_savings'</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">:.2f</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">/month)"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<h3 id="automated-resource-scheduling">Automated Resource Scheduling</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># kubernetes/cost-optimization/scheduler.yaml</span></span>
<span class="line"><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">batch/v1</span></span>
<span class="line"><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">CronJob</span></span>
<span class="line"><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">scale-down-dev-environments</span></span>
<span class="line"><span style="color:#85E89D">  namespace</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">cost-optimization</span></span>
<span class="line"><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  schedule</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"0 19 * * 1-5"</span><span style="color:#6A737D">  # 7 PM weekdays</span></span>
<span class="line"><span style="color:#85E89D">  jobTemplate</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      template</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          serviceAccountName</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">cost-optimizer</span></span>
<span class="line"><span style="color:#85E89D">          containers</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">          - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">kubectl</span></span>
<span class="line"><span style="color:#85E89D">            image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">bitnami/kubectl:latest</span></span>
<span class="line"><span style="color:#85E89D">            command</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">/bin/sh</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">-c</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#F97583">|</span></span>
<span class="line"><span style="color:#9ECBFF">              echo "Scaling down development environments..."</span></span>
<span class="line"><span style="color:#9ECBFF">              </span></span>
<span class="line"><span style="color:#9ECBFF">              # Scale down deployments in development namespaces</span></span>
<span class="line"><span style="color:#9ECBFF">              for ns in development staging; do</span></span>
<span class="line"><span style="color:#9ECBFF">                echo "Scaling down deployments in $ns namespace"</span></span>
<span class="line"><span style="color:#9ECBFF">                kubectl get deployments -n $ns -o name | while read deployment; do</span></span>
<span class="line"><span style="color:#9ECBFF">                  current_replicas=$(kubectl get $deployment -n $ns -o jsonpath='{.spec.replicas}')</span></span>
<span class="line"><span style="color:#9ECBFF">                  if [ "$current_replicas" -gt 0 ]; then</span></span>
<span class="line"><span style="color:#9ECBFF">                    # Store current replica count for scale-up</span></span>
<span class="line"><span style="color:#9ECBFF">                    kubectl annotate $deployment -n $ns cost-optimizer/original-replicas=$current_replicas --overwrite</span></span>
<span class="line"><span style="color:#9ECBFF">                    # Scale down to 0</span></span>
<span class="line"><span style="color:#9ECBFF">                    kubectl scale $deployment -n $ns --replicas=0</span></span>
<span class="line"><span style="color:#9ECBFF">                    echo "Scaled down $deployment from $current_replicas to 0"</span></span>
<span class="line"><span style="color:#9ECBFF">                  fi</span></span>
<span class="line"><span style="color:#9ECBFF">                done</span></span>
<span class="line"><span style="color:#9ECBFF">              done</span></span>
<span class="line"><span style="color:#9ECBFF">              </span></span>
<span class="line"><span style="color:#9ECBFF">              echo "Development environments scaled down for cost optimization"</span></span>
<span class="line"><span style="color:#85E89D">          restartPolicy</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">OnFailure</span></span>
<span class="line"><span style="color:#B392F0">---</span></span>
<span class="line"><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">batch/v1</span></span>
<span class="line"><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">CronJob</span></span>
<span class="line"><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">scale-up-dev-environments</span></span>
<span class="line"><span style="color:#85E89D">  namespace</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">cost-optimization</span></span>
<span class="line"><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  schedule</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"0 8 * * 1-5"</span><span style="color:#6A737D">   # 8 AM weekdays</span></span>
<span class="line"><span style="color:#85E89D">  jobTemplate</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      template</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          serviceAccountName</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">cost-optimizer</span></span>
<span class="line"><span style="color:#85E89D">          containers</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">          - </span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">kubectl</span></span>
<span class="line"><span style="color:#85E89D">            image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">bitnami/kubectl:latest</span></span>
<span class="line"><span style="color:#85E89D">            command</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">/bin/sh</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#9ECBFF">-c</span></span>
<span class="line"><span style="color:#E1E4E8">            - </span><span style="color:#F97583">|</span></span>
<span class="line"><span style="color:#9ECBFF">              echo "Scaling up development environments..."</span></span>
<span class="line"><span style="color:#9ECBFF">              </span></span>
<span class="line"><span style="color:#9ECBFF">              # Scale up deployments in development namespaces</span></span>
<span class="line"><span style="color:#9ECBFF">              for ns in development staging; do</span></span>
<span class="line"><span style="color:#9ECBFF">                echo "Scaling up deployments in $ns namespace"</span></span>
<span class="line"><span style="color:#9ECBFF">                kubectl get deployments -n $ns -o name | while read deployment; do</span></span>
<span class="line"><span style="color:#9ECBFF">                  original_replicas=$(kubectl get $deployment -n $ns -o jsonpath='{.metadata.annotations.cost-optimizer/original-replicas}')</span></span>
<span class="line"><span style="color:#9ECBFF">                  if [ -n "$original_replicas" ] &#x26;&#x26; [ "$original_replicas" -gt 0 ]; then</span></span>
<span class="line"><span style="color:#9ECBFF">                    kubectl scale $deployment -n $ns --replicas=$original_replicas</span></span>
<span class="line"><span style="color:#9ECBFF">                    echo "Scaled up $deployment to $original_replicas replicas"</span></span>
<span class="line"><span style="color:#9ECBFF">                  fi</span></span>
<span class="line"><span style="color:#9ECBFF">                done</span></span>
<span class="line"><span style="color:#9ECBFF">              done</span></span>
<span class="line"><span style="color:#9ECBFF">              </span></span>
<span class="line"><span style="color:#9ECBFF">              echo "Development environments scaled up for business hours"</span></span>
<span class="line"><span style="color:#85E89D">          restartPolicy</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">OnFailure</span></span>
<span class="line"></span></code></pre>
<h2 id="security-and-compliance">Security and Compliance</h2>
<h3 id="network-security-configuration">Network Security Configuration</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># security/network-policies.yaml</span></span>
<span class="line"><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">NetworkPolicy</span></span>
<span class="line"><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">deny-all-default</span></span>
<span class="line"><span style="color:#85E89D">  namespace</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">production</span></span>
<span class="line"><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  podSelector</span><span style="color:#E1E4E8">: {}</span></span>
<span class="line"><span style="color:#85E89D">  policyTypes</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#9ECBFF">Ingress</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#9ECBFF">Egress</span></span>
<span class="line"><span style="color:#B392F0">---</span></span>
<span class="line"><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">NetworkPolicy</span></span>
<span class="line"><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">allow-frontend-to-api</span></span>
<span class="line"><span style="color:#85E89D">  namespace</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">production</span></span>
<span class="line"><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  podSelector</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    matchLabels</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">api</span></span>
<span class="line"><span style="color:#85E89D">  policyTypes</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#9ECBFF">Ingress</span></span>
<span class="line"><span style="color:#85E89D">  ingress</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">from</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#85E89D">podSelector</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        matchLabels</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">frontend</span></span>
<span class="line"><span style="color:#85E89D">    ports</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#85E89D">protocol</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">TCP</span></span>
<span class="line"><span style="color:#85E89D">      port</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3000</span></span>
<span class="line"><span style="color:#B392F0">---</span></span>
<span class="line"><span style="color:#85E89D">apiVersion</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D">kind</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">NetworkPolicy</span></span>
<span class="line"><span style="color:#85E89D">metadata</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">allow-api-to-database</span></span>
<span class="line"><span style="color:#85E89D">  namespace</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">production</span></span>
<span class="line"><span style="color:#85E89D">spec</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  podSelector</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    matchLabels</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">api</span></span>
<span class="line"><span style="color:#85E89D">  policyTypes</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#9ECBFF">Egress</span></span>
<span class="line"><span style="color:#85E89D">  egress</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">to</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#85E89D">podSelector</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        matchLabels</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">          app</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">database</span></span>
<span class="line"><span style="color:#85E89D">    ports</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#85E89D">protocol</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">TCP</span></span>
<span class="line"><span style="color:#85E89D">      port</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">5432</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">to</span><span style="color:#E1E4E8">: []  </span><span style="color:#6A737D"># Allow DNS</span></span>
<span class="line"><span style="color:#85E89D">    ports</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#85E89D">protocol</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">UDP</span></span>
<span class="line"><span style="color:#85E89D">      port</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">53</span></span>
<span class="line"></span></code></pre>
<h3 id="secrets-management">Secrets Management</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// utils/secrets-manager.ts</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { </span></span>
<span class="line"><span style="color:#E1E4E8">  SecretsManagerClient, </span></span>
<span class="line"><span style="color:#E1E4E8">  GetSecretValueCommand,</span></span>
<span class="line"><span style="color:#E1E4E8">  RotateSecretCommand </span></span>
<span class="line"><span style="color:#E1E4E8">} </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "@aws-sdk/client-secrets-manager"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">interface</span><span style="color:#B392F0"> DatabaseCredentials</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#FFAB70">  username</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">  password</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">  host</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">  port</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> number</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">  database</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">interface</span><span style="color:#B392F0"> ApiCredentials</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#FFAB70">  stripeKey</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">  sendgridKey</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">  jwtSecret</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> SecretsManager</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#FFAB70"> client</span><span style="color:#F97583">:</span><span style="color:#B392F0"> SecretsManagerClient</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#FFAB70"> cache</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Map</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#79B8FF">string</span><span style="color:#E1E4E8">, { </span><span style="color:#FFAB70">value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">; </span><span style="color:#FFAB70">expiry</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> number</span><span style="color:#E1E4E8"> }> </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#F97583"> readonly</span><span style="color:#FFAB70"> CACHE_TTL</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 5</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 60</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// 5 minutes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">region</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> process.env.</span><span style="color:#79B8FF">AWS_REGION</span><span style="color:#F97583"> ||</span><span style="color:#9ECBFF"> 'us-west-2'</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.client </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> SecretsManagerClient</span><span style="color:#E1E4E8">({ region });</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> getSecret</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">>(</span><span style="color:#FFAB70">secretName</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Promise</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#6A737D">    // Check cache first</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> cached</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.cache.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(secretName);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (cached </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> cached.expiry </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> Date.</span><span style="color:#B392F0">now</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#E1E4E8"> cached.value;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> command</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> GetSecretValueCommand</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">        SecretId: secretName,</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.client.</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(command);</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> secretValue</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">parse</span><span style="color:#E1E4E8">(response.SecretString </span><span style="color:#F97583">||</span><span style="color:#9ECBFF"> '{}'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#6A737D">      // Cache the secret</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#E1E4E8">.cache.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(secretName, {</span></span>
<span class="line"><span style="color:#E1E4E8">        value: secretValue,</span></span>
<span class="line"><span style="color:#E1E4E8">        expiry: Date.</span><span style="color:#B392F0">now</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">CACHE_TTL</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#E1E4E8"> secretValue;</span></span>
<span class="line"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8">      console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Error retrieving secret ${</span><span style="color:#E1E4E8">secretName</span><span style="color:#9ECBFF">}:`</span><span style="color:#E1E4E8">, error);</span></span>
<span class="line"><span style="color:#F97583">      throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Failed to retrieve secret: ${</span><span style="color:#E1E4E8">secretName</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> getDatabaseCredentials</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Promise</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">DatabaseCredentials</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">getSecret</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">DatabaseCredentials</span><span style="color:#E1E4E8">>(</span><span style="color:#9ECBFF">'production/database/credentials'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> getApiCredentials</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Promise</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">ApiCredentials</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">getSecret</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">ApiCredentials</span><span style="color:#E1E4E8">>(</span><span style="color:#9ECBFF">'production/api/credentials'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> rotateSecret</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">secretName</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Promise</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#79B8FF">void</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> command</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> RotateSecretCommand</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">        SecretId: secretName,</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.client.</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(command);</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#6A737D">      // Clear from cache to force refresh</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#E1E4E8">.cache.</span><span style="color:#B392F0">delete</span><span style="color:#E1E4E8">(secretName);</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#E1E4E8">      console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Successfully initiated rotation for secret: ${</span><span style="color:#E1E4E8">secretName</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8">      console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Error rotating secret ${</span><span style="color:#E1E4E8">secretName</span><span style="color:#9ECBFF">}:`</span><span style="color:#E1E4E8">, error);</span></span>
<span class="line"><span style="color:#F97583">      throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Failed to rotate secret: ${</span><span style="color:#E1E4E8">secretName</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  clearCache</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> void</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.cache.</span><span style="color:#B392F0">clear</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> SecretsManager;</span></span>
<span class="line"></span></code></pre>
<h2 id="migration-strategies-and-planning">Migration Strategies and Planning</h2>
<h3 id="assessment-framework">Assessment Framework</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#6A737D"># scripts/migration-assessment.py</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> typing </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> Dict, List, Optional</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> json</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> dataclasses </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> dataclass</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> enum </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> Enum</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> MigrationComplexity</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Enum</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">    LOW</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "low"</span></span>
<span class="line"><span style="color:#79B8FF">    MEDIUM</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "medium"</span></span>
<span class="line"><span style="color:#79B8FF">    HIGH</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "high"</span></span>
<span class="line"><span style="color:#79B8FF">    VERY_HIGH</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "very_high"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> MigrationType</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Enum</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">    REHOST</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "rehost"</span><span style="color:#6A737D">          # Lift and shift</span></span>
<span class="line"><span style="color:#79B8FF">    REPLATFORM</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "replatform"</span><span style="color:#6A737D">   # Lift, tinker, and shift</span></span>
<span class="line"><span style="color:#79B8FF">    REFACTOR</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "refactor"</span><span style="color:#6A737D">       # Re-architect</span></span>
<span class="line"><span style="color:#79B8FF">    RETIRE</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "retire"</span><span style="color:#6A737D">           # Decommission</span></span>
<span class="line"><span style="color:#79B8FF">    RETAIN</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "retain"</span><span style="color:#6A737D">           # Keep on-premises</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">@dataclass</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Application</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    name: </span><span style="color:#79B8FF">str</span></span>
<span class="line"><span style="color:#E1E4E8">    technology_stack: List[</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    dependencies: List[</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    data_size_gb: </span><span style="color:#79B8FF">int</span></span>
<span class="line"><span style="color:#E1E4E8">    users_count: </span><span style="color:#79B8FF">int</span></span>
<span class="line"><span style="color:#E1E4E8">    compliance_requirements: List[</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    current_infrastructure: </span><span style="color:#79B8FF">str</span></span>
<span class="line"><span style="color:#E1E4E8">    business_criticality: </span><span style="color:#79B8FF">str</span><span style="color:#6A737D">  # low, medium, high, critical</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> MigrationAssessment</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#79B8FF"> __init__</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.applications: List[Application] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.migration_waves: List[List[Application]] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> assess_application</span><span style="color:#E1E4E8">(self, app: Application) -> Dict:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Assess an application for cloud migration readiness"""</span></span>
<span class="line"><span style="color:#E1E4E8">        complexity </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">._calculate_complexity(app)</span></span>
<span class="line"><span style="color:#E1E4E8">        migration_type </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">._recommend_migration_type(app)</span></span>
<span class="line"><span style="color:#E1E4E8">        effort_weeks </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">._estimate_effort(app, complexity)</span></span>
<span class="line"><span style="color:#E1E4E8">        cost_estimate </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">._estimate_cost(app, migration_type)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">            'application'</span><span style="color:#E1E4E8">: app.name,</span></span>
<span class="line"><span style="color:#9ECBFF">            'complexity'</span><span style="color:#E1E4E8">: complexity.value,</span></span>
<span class="line"><span style="color:#9ECBFF">            'recommended_migration_type'</span><span style="color:#E1E4E8">: migration_type.value,</span></span>
<span class="line"><span style="color:#9ECBFF">            'estimated_effort_weeks'</span><span style="color:#E1E4E8">: effort_weeks,</span></span>
<span class="line"><span style="color:#9ECBFF">            'estimated_cost_usd'</span><span style="color:#E1E4E8">: cost_estimate,</span></span>
<span class="line"><span style="color:#9ECBFF">            'dependencies'</span><span style="color:#E1E4E8">: app.dependencies,</span></span>
<span class="line"><span style="color:#9ECBFF">            'risks'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">._identify_risks(app),</span></span>
<span class="line"><span style="color:#9ECBFF">            'benefits'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">._identify_benefits(app),</span></span>
<span class="line"><span style="color:#9ECBFF">            'prerequisites'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">._identify_prerequisites(app)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _calculate_complexity</span><span style="color:#E1E4E8">(self, app: Application) -> MigrationComplexity:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Calculate migration complexity based on various factors"""</span></span>
<span class="line"><span style="color:#E1E4E8">        complexity_score </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Technology stack complexity</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">(tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'mainframe'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'legacy'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'cobol'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> app.technology_stack):</span></span>
<span class="line"><span style="color:#E1E4E8">            complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">(tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'windows'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'.net'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'sql_server'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> app.technology_stack):</span></span>
<span class="line"><span style="color:#E1E4E8">            complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">(tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'java'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'python'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'node.js'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'postgres'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> app.technology_stack):</span></span>
<span class="line"><span style="color:#E1E4E8">            complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Data size impact</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.data_size_gb </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> app.data_size_gb </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Dependencies</span></span>
<span class="line"><span style="color:#E1E4E8">        complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> min</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(app.dependencies), </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Compliance requirements</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.compliance_requirements:</span></span>
<span class="line"><span style="color:#E1E4E8">            complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(app.compliance_requirements)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Business criticality</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.business_criticality </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> 'critical'</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> app.business_criticality </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> 'high'</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            complexity_score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> complexity_score </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> MigrationComplexity.</span><span style="color:#79B8FF">LOW</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> complexity_score </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 6</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> MigrationComplexity.</span><span style="color:#79B8FF">MEDIUM</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> complexity_score </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 9</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> MigrationComplexity.</span><span style="color:#79B8FF">HIGH</span></span>
<span class="line"><span style="color:#F97583">        else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> MigrationComplexity.</span><span style="color:#79B8FF">VERY_HIGH</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _recommend_migration_type</span><span style="color:#E1E4E8">(self, app: Application) -> MigrationType:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Recommend migration strategy based on application characteristics"""</span></span>
<span class="line"><span style="color:#6A737D">        # Check if application should be retired</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.users_count </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> or</span><span style="color:#9ECBFF"> 'deprecated'</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> app.technology_stack:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> MigrationType.</span><span style="color:#79B8FF">RETIRE</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Check if application should be retained on-premises</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (app.business_criticality </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> 'critical'</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#79B8FF">            any</span><span style="color:#E1E4E8">(req </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'air_gapped'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'classified'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> req </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> app.compliance_requirements)):</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> MigrationType.</span><span style="color:#79B8FF">RETAIN</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Check for refactoring opportunities</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">any</span><span style="color:#E1E4E8">(tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'microservices'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'containers'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'kubernetes'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> app.technology_stack) </span><span style="color:#F97583">or</span></span>
<span class="line"><span style="color:#E1E4E8">            app.users_count </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 10000</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> MigrationType.</span><span style="color:#79B8FF">REFACTOR</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Check for replatforming opportunities</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">(tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'java'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'python'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'node.js'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> app.technology_stack):</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> MigrationType.</span><span style="color:#79B8FF">REPLATFORM</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Default to rehosting</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> MigrationType.</span><span style="color:#79B8FF">REHOST</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _estimate_effort</span><span style="color:#E1E4E8">(self, app: Application, complexity: MigrationComplexity) -> </span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Estimate migration effort in weeks"""</span></span>
<span class="line"><span style="color:#E1E4E8">        base_effort </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationComplexity.</span><span style="color:#79B8FF">LOW</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationComplexity.</span><span style="color:#79B8FF">MEDIUM</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationComplexity.</span><span style="color:#79B8FF">HIGH</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationComplexity.</span><span style="color:#79B8FF">VERY_HIGH</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">24</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        effort </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> base_effort[complexity]</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Add effort for data migration</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.data_size_gb </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            effort </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.data_size_gb </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            effort </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 4</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Add effort for dependencies</span></span>
<span class="line"><span style="color:#E1E4E8">        effort </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(app.dependencies)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> effort</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _estimate_cost</span><span style="color:#E1E4E8">(self, app: Application, migration_type: MigrationType) -> </span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Estimate migration cost in USD"""</span></span>
<span class="line"><span style="color:#E1E4E8">        base_costs </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationType.</span><span style="color:#79B8FF">REHOST</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">10000</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationType.</span><span style="color:#79B8FF">REPLATFORM</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">25000</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationType.</span><span style="color:#79B8FF">REFACTOR</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">50000</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationType.</span><span style="color:#79B8FF">RETIRE</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            MigrationType.</span><span style="color:#79B8FF">RETAIN</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        base_cost </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> base_costs[migration_type]</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # Scale by user count</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.users_count </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            base_cost </span><span style="color:#F97583">*=</span><span style="color:#79B8FF"> 1.5</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.users_count </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 10000</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            base_cost </span><span style="color:#F97583">*=</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> int</span><span style="color:#E1E4E8">(base_cost)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _identify_risks</span><span style="color:#E1E4E8">(self, app: Application) -> List[</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Identify migration risks"""</span></span>
<span class="line"><span style="color:#E1E4E8">        risks </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.data_size_gb </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            risks.append(</span><span style="color:#9ECBFF">"Large data migration may cause extended downtime"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.business_criticality </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> 'critical'</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            risks.append(</span><span style="color:#9ECBFF">"Critical application requires careful migration planning"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(app.dependencies) </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            risks.append(</span><span style="color:#9ECBFF">"Complex dependencies may cause integration issues"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">(tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'legacy'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'mainframe'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> tech </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> app.technology_stack):</span></span>
<span class="line"><span style="color:#E1E4E8">            risks.append(</span><span style="color:#9ECBFF">"Legacy technology may have limited cloud compatibility"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> risks</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _identify_benefits</span><span style="color:#E1E4E8">(self, app: Application) -> List[</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Identify migration benefits"""</span></span>
<span class="line"><span style="color:#E1E4E8">        benefits </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#9ECBFF">            "Improved scalability and elasticity"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            "Reduced infrastructure management overhead"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            "Enhanced disaster recovery capabilities"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            "Access to managed services and latest technologies"</span></span>
<span class="line"><span style="color:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.users_count </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            benefits.append(</span><span style="color:#9ECBFF">"Better performance for high-traffic applications"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#9ECBFF"> 'windows'</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> app.technology_stack:</span></span>
<span class="line"><span style="color:#E1E4E8">            benefits.append(</span><span style="color:#9ECBFF">"Reduced Windows licensing costs"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> benefits</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> _identify_prerequisites</span><span style="color:#E1E4E8">(self, app: Application) -> List[</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Identify migration prerequisites"""</span></span>
<span class="line"><span style="color:#E1E4E8">        prerequisites </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#9ECBFF">            "Network connectivity setup (VPN or Direct Connect)"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            "Cloud account setup and IAM configuration"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            "Backup and disaster recovery planning"</span></span>
<span class="line"><span style="color:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.compliance_requirements:</span></span>
<span class="line"><span style="color:#E1E4E8">            prerequisites.append(</span><span style="color:#9ECBFF">"Compliance assessment and approval"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> app.data_size_gb </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            prerequisites.append(</span><span style="color:#9ECBFF">"Data migration strategy and tools"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> prerequisites</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> create_migration_waves</span><span style="color:#E1E4E8">(self, assessments: List[Dict]) -> List[List[</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">]]:</span></span>
<span class="line"><span style="color:#9ECBFF">        """Organize applications into migration waves"""</span></span>
<span class="line"><span style="color:#6A737D">        # Sort by complexity and dependencies</span></span>
<span class="line"><span style="color:#E1E4E8">        sorted_apps </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> sorted</span><span style="color:#E1E4E8">(assessments, </span><span style="color:#FFAB70">key</span><span style="color:#F97583">=lambda</span><span style="color:#E1E4E8"> x: (</span></span>
<span class="line"><span style="color:#79B8FF">            len</span><span style="color:#E1E4E8">([dep </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> dep </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> x.get(</span><span style="color:#9ECBFF">'dependencies'</span><span style="color:#E1E4E8">, []) </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> dep </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> [a[</span><span style="color:#9ECBFF">'application'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> assessments]]),</span></span>
<span class="line"><span style="color:#E1E4E8">            {</span><span style="color:#9ECBFF">'low'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'medium'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'high'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'very_high'</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">}[x[</span><span style="color:#9ECBFF">'complexity'</span><span style="color:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#E1E4E8">        ))</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        waves </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#E1E4E8">        current_wave </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#E1E4E8">        max_wave_size </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 5</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> app </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> sorted_apps:</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(current_wave) </span><span style="color:#F97583">>=</span><span style="color:#E1E4E8"> max_wave_size:</span></span>
<span class="line"><span style="color:#E1E4E8">                waves.append(current_wave)</span></span>
<span class="line"><span style="color:#E1E4E8">                current_wave </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#E1E4E8">            current_wave.append(app[</span><span style="color:#9ECBFF">'application'</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> current_wave:</span></span>
<span class="line"><span style="color:#E1E4E8">            waves.append(current_wave)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> waves</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Usage example</span></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    assessment </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> MigrationAssessment()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    # Example applications</span></span>
<span class="line"><span style="color:#E1E4E8">    apps </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        Application(</span></span>
<span class="line"><span style="color:#FFAB70">            name</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"Legacy HR System"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            technology_stack</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">"java"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"oracle"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"windows"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#FFAB70">            dependencies</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">"Active Directory"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Email System"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#FFAB70">            data_size_gb</span><span style="color:#F97583">=</span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            users_count</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            compliance_requirements</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">"SOX"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"GDPR"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#FFAB70">            current_infrastructure</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"on_premises"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            business_criticality</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"high"</span></span>
<span class="line"><span style="color:#E1E4E8">        ),</span></span>
<span class="line"><span style="color:#E1E4E8">        Application(</span></span>
<span class="line"><span style="color:#FFAB70">            name</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"E-commerce Platform"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            technology_stack</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">"node.js"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"react"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"postgres"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"redis"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#FFAB70">            dependencies</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">"Payment Gateway"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"CDN"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#FFAB70">            data_size_gb</span><span style="color:#F97583">=</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            users_count</span><span style="color:#F97583">=</span><span style="color:#79B8FF">50000</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            compliance_requirements</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">"PCI-DSS"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#FFAB70">            current_infrastructure</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"on_premises"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            business_criticality</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"critical"</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    assessments </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> app </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> apps:</span></span>
<span class="line"><span style="color:#E1E4E8">        assessment_result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> assessment.assess_application(app)</span></span>
<span class="line"><span style="color:#E1E4E8">        assessments.append(assessment_result)</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Assessment for </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">app.name</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">:"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(json.dumps(assessment_result, </span><span style="color:#FFAB70">indent</span><span style="color:#F97583">=</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"-"</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 50</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    # Create migration waves</span></span>
<span class="line"><span style="color:#E1E4E8">    waves </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> assessment.create_migration_waves(assessments)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Migration Waves:"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i, wave </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> enumerate</span><span style="color:#E1E4E8">(waves, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Wave </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">i</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">: </span><span style="color:#79B8FF">{</span><span style="color:#9ECBFF">', '</span><span style="color:#E1E4E8">.join(wave)</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#79B8FF"> __name__</span><span style="color:#F97583"> ==</span><span style="color:#9ECBFF"> "__main__"</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    main()</span></span>
<span class="line"></span></code></pre>
<h2 id="implementation-roadmap">Implementation Roadmap</h2>
<h3 id="phase-1-foundation-weeks-1-4">Phase 1: Foundation (Weeks 1-4)</h3>
<ul>
<li><strong>Infrastructure Setup</strong>: VPC/VNet, security groups, IAM roles</li>
<li><strong>CI/CD Pipeline</strong>: GitHub Actions, container registry, deployment automation</li>
<li><strong>Monitoring</strong>: Prometheus, Grafana, alerting rules</li>
<li><strong>Security</strong>: Secrets management, network policies, security scanning</li>
</ul>
<h3 id="phase-2-core-services-weeks-5-8">Phase 2: Core Services (Weeks 5-8)</h3>
<ul>
<li><strong>Database Migration</strong>: RDS/Azure Database setup with replication</li>
<li><strong>Application Deployment</strong>: Containerized services on EKS/AKS</li>
<li><strong>Load Balancing</strong>: ALB/Application Gateway configuration</li>
<li><strong>Auto-scaling</strong>: HPA and cluster autoscaling</li>
</ul>
<h3 id="phase-3-optimization-weeks-9-12">Phase 3: Optimization (Weeks 9-12)</h3>
<ul>
<li><strong>Performance Tuning</strong>: Resource optimization, caching implementation</li>
<li><strong>Cost Optimization</strong>: Right-sizing, scheduled scaling, reserved instances</li>
<li><strong>Security Hardening</strong>: Compliance validation, penetration testing</li>
<li><strong>Documentation</strong>: Runbooks, architecture diagrams, team training</li>
</ul>
<h3 id="phase-4-production-readiness-weeks-13-16">Phase 4: Production Readiness (Weeks 13-16)</h3>
<ul>
<li><strong>Disaster Recovery</strong>: Multi-region setup, backup validation</li>
<li><strong>Performance Testing</strong>: Load testing, chaos engineering</li>
<li><strong>Go-Live Planning</strong>: Cutover procedures, rollback strategies</li>
<li><strong>Post-Migration Support</strong>: Monitoring, optimization, team enablement</li>
</ul>
<h2 id="success-metrics-and-kpis">Success Metrics and KPIs</h2>
<h3 id="technical-performance">Technical Performance</h3>
<ul>
<li><strong>Availability</strong>: 99.9%+ uptime</li>
<li><strong>Performance</strong>: &#x3C; 200ms API response times</li>
<li><strong>Scalability</strong>: Handle 10x traffic without manual intervention</li>
<li><strong>Security</strong>: Zero critical security vulnerabilities</li>
</ul>
<h3 id="business-impact">Business Impact</h3>
<ul>
<li><strong>Cost Reduction</strong>: 30-50% infrastructure cost savings</li>
<li><strong>Deployment Velocity</strong>: 75% faster feature delivery</li>
<li><strong>Operational Efficiency</strong>: 60% reduction in manual tasks</li>
<li><strong>Innovation</strong>: 40% faster time-to-market for new features</li>
</ul>
<h3 id="team-productivity">Team Productivity</h3>
<ul>
<li><strong>Deployment Frequency</strong>: Daily deployments with zero downtime</li>
<li><strong>Mean Time to Recovery</strong>: &#x3C; 30 minutes for production issues</li>
<li><strong>Developer Experience</strong>: Self-service infrastructure provisioning</li>
<li><strong>Knowledge Transfer</strong>: 90% team proficiency in cloud technologies</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Successful cloud infrastructure implementation requires careful planning, proven architectural patterns, and continuous optimization. The strategies and examples outlined in this guide provide a foundation for building scalable, secure, and cost-effective cloud solutions.</p>
<p>The key to effective cloud adoption lies in understanding both the technical capabilities of modern platforms and the unique requirements of your organization. Whether migrating existing applications or building new cloud-native solutions, following these proven patterns will help ensure successful outcomes.</p>
<p>Through my experience implementing cloud solutions across diverse industries, I’ve observed that organizations achieving the greatest success are those that invest in proper planning, embrace automation, and maintain a focus on continuous improvement. The cloud provides unprecedented opportunities for innovation and efficiency when leveraged correctly.</p>
<hr>
<p><strong>Keywords</strong>: AWS cloud architecture, Azure infrastructure, cloud migration, Kubernetes deployment, DevOps automation, cloud cost optimization, enterprise cloud strategy, microservices architecture</p> </div> </div> </div> <!-- Article Footer --> <footer class="mt-12 bg-white rounded-2xl p-8 shadow-sm border border-gray-100"> <div class="flex items-center justify-between"> <a href="/" class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium transition-colors group"> <svg class="w-4 h-4 mr-2 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path> </svg>
Back to Home
</a> <div class="flex items-center space-x-4 text-sm text-gray-500"> <span>Share this article:</span> <a href="https://twitter.com/intent/tweet?text=AWS%20and%20Azure%20Cloud%20Infrastructure%3A%20Enterprise%20Migration%20and%20Optimization%20Strategies&url=https%3A%2F%2Fdvorson.github.io" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-500 transition-colors"> <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path> </svg> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fdvorson.github.io" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-600 transition-colors"> <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path> </svg> </a> </div> </div> </footer> </article>  </main> <!-- Footer --> <footer class="bg-white border-t border-gray-100 py-8"> <div class="container mx-auto text-center"> <p class="text-gray-600 text-sm">
© 2025 Anton Dvorson. All rights reserved.
</p> <div class="mt-4 flex justify-center space-x-4"> <a href="https://github.com/dvorson" class="text-gray-400 hover:text-gray-700 transition-colors" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github text-lg"></i> </a> <a href="https://linkedin.com/in/" class="text-gray-400 hover:text-gray-700 transition-colors" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin text-lg"></i> </a> <a href="https://twitter.com/" class="text-gray-400 hover:text-gray-700 transition-colors" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter text-lg"></i> </a> </div> </div> </footer> </body></html>